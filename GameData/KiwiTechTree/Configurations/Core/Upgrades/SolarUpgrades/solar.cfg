// Kiwi's Tech Tree Overhaul (Solar Panel Upgrades)
// Version 2.0
// Created: 3 November 2020 for KSP 1.9.1 to 1.10.1
// Last Updated: 4 January 2021 for KSP 1.11.1
// 23 November 2020: Added switch to disable solar upgrades
// 3 January 2021: Updated for new upgrade system; removed NF Solar as a requirement.

@PART[*]:HAS[#kiwiSolarUpgradeType[standard],~solarUpgrade[off],!MODULE[ModuleB9PartSwitch]:HAS[#moduleID[cellSwitch]]]:FOR[zzKiwiTechTree]
{
	// These will not be configurable for now as they are based on the balance by NFS
	%addCost_0 = #$cost$
	@addCost_0 *= 0.0
	%addMass_0 = #$mass$
	@addMass_0 *= 0.0
	%chargeRate_0 = 1.0
	
	%addCost_1 = #$cost$
	@addCost_1 *= 1.1
	%addMass_1 = #$mass$
	@addMass_1 *= 0.0
	%chargeRate_1 = 1.3
	
	%addCost_2 = #$cost$
	@addCost_2 *= 2.1
	%addMass_2 = #$mass$
	@addMass_2 *= 0.0
	%chargeRate_2 = 1.75
	
	%addCost_3 = #$cost$
	@addCost_3 *= 3.0
	%addMass_3 = #$mass$
	@addMass_3 *= 0.0
	%chargeRate_3 = 2.50
	
	%baseChargeRate = #$MODULE[ModuleDeployableSolarPanel],0/chargeRate$
	%chargeRate_0 *= #$baseChargeRate$
	%chargeRate_1 *= #$baseChargeRate$
	%chargeRate_2 *= #$baseChargeRate$
	%chargeRate_3 *= #$baseChargeRate$
	
	@MODULE[ModuleDeployableSolarPanel],*
	{
		!UPGRADES {} // No use having multple upgrades
	}
	
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = cellSwitch
		switcherDescription = #LOC_KTT_B9DESCRIPTIONPLURALS_CELLSWITCH // Cell Switch
		switcherDescriptionPlural = #LOC_KTT_B9DESCRIPTIONPLURALS_CELLTYPES //Cell Types
		affectDragCubes = False
		affectFARVoxels = False

		SUBTYPE
		{
			name = Basic
			title = #LOC_KTT_B9DESCRIPTION_SOLAR_BASIC_TITLE
			descriptionSummary = #LOC_NFSolar_switcher_cell_basic_summary
			descriptionDetail = #LOC_NFSolar_switcher_cell_basic_detail
			primaryColor = #aebac0
			secondaryColor = #aebac0
			addedCost = #$../../addCost_0$
			addedMass = #$../../addMass_0$
			
			defaultSubtypePriority = 1
			
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleDeployableSolarPanel
				}
				DATA 
				{
					chargeRate = #$../../../../chargeRate_0$
				}
			}
		}
		
		SUBTYPE
		{
			name = Advanced
			title = #LOC_KTT_B9DESCRIPTION_SOLAR_ADVANCED_TITLE
			descriptionSummary = #LOC_NFSolar_switcher_cell_adv_summary
			descriptionDetail = #LOC_NFSolar_switcher_cell_adv_detail
			primaryColor = #5d7682
			secondaryColor = #5d7682
			
			upgradeRequired = advancedSolarCell
			addedCost = #$../../addCost_1$
			addedMass = #$../../addMass_1$
			
			
			defaultSubtypePriority = 0
			
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleDeployableSolarPanel
				}
				DATA 
				{
					chargeRate = #$../../../../chargeRate_1$
				}
			}
		}
		
		SUBTYPE
		{
			name = Concentrating
			title = #LOC_KTT_B9DESCRIPTION_SOLAR_CONCENTRATING_TITLE
			descriptionSummary = #LOC_NFSolar_switcher_cell_concentrating_summary
			descriptionDetail = #LOC_NFSolar_switcher_cell_concentrating_detail
			primaryColor = #2d373c
			secondaryColor = #2d373c
			
			upgradeRequired = concentratingSolarCell
			addedCost = #$../../addCost_2$
			addedMass = #$../../addMass_2$
			
			
			defaultSubtypePriority = 0

			MODULE
			{
				IDENTIFIER
				{
					name = ModuleDeployableSolarPanel
				}
				DATA 
				{
					chargeRate = #$../../../../chargeRate_2$
				}
			}
		}
		
		SUBTYPE
		{
			name = Experimental
			title = #LOC_KTT_B9DESCRIPTION_SOLAR_EXPERIMENTAL_TITLE
			descriptionSummary = #LOC_NFSolar_switcher_cell_concentrating_summary
			descriptionDetail = #LOC_NFSolar_switcher_cell_concentrating_detail
			primaryColor = #000000
			secondaryColor = #000000
			
			upgradeRequired = experimentalSolarCell
			addedCost = #$../../addCost_3$
			addedMass = #$../../addMass_3$
			
			
			defaultSubtypePriority = 0

			MODULE
			{
				IDENTIFIER
				{
					name = ModuleDeployableSolarPanel
				}
				DATA 
				{
					chargeRate = #$../../../../chargeRate_3$
				}
			}
		}
	}
}

@PART[*]:HAS[#solarPanelUpgradeTier[1],~solarUpgrade[off]]:NEEDS[NearFutureSolar]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>The solar panel has advanced upgrades in $@PARTUPGRADE[kiwiSolarTier1_Advanced]/techRequired$ and concentrator upgrades in $@PARTUPGRADE[kiwiSolarTier1_Concentrating]/techRequired$!</color> 
}
@PART[*]:HAS[#solarPanelUpgradeTier[2],~solarUpgrade[off]]:NEEDS[NearFutureSolar]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>The solar panel has advanced upgrades in $@PARTUPGRADE[kiwiSolarTier2_Advanced]/techRequired$ and concentrator upgrades in $@PARTUPGRADE[kiwiSolarTier2_Concentrating]/techRequired$!</color> 
}
@PART[*]:HAS[#solarPanelUpgradeTier[3],~solarUpgrade[off]]:NEEDS[NearFutureSolar]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>The solar panel has advanced upgrades in $@PARTUPGRADE[kiwiSolarTier3_Advanced]/techRequired$ and concentrator upgrades in $@PARTUPGRADE[kiwiSolarTier3_Concentrating]/techRequired$!</color> 
}
@PART[*]:HAS[#solarPanelUpgradeTier[4],~solarUpgrade[off]]:NEEDS[NearFutureSolar]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>The solar panel has advanced upgrades in $@PARTUPGRADE[kiwiSolarTier4_Advanced]/techRequired$ and concentrator upgrades in $@PARTUPGRADE[kiwiSolarTier4_Concentrating]/techRequired$!</color> 
}
@PART[*]:HAS[#solarPanelUpgradeTier[5],~solarUpgrade[off]]:NEEDS[NearFutureSolar]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>The solar panel has advanced upgrades in $@PARTUPGRADE[kiwiSolarTier5_Advanced]/techRequired$ and concentrator upgrades in $@PARTUPGRADE[kiwiSolarTier5_Concentrating]/techRequired$!</color> 
}
@PART[*]:HAS[#solarPanelUpgradeTier[6],~solarUpgrade[off]]:NEEDS[NearFutureSolar]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>The solar panel has advanced upgrades in $@PARTUPGRADE[kiwiSolarTier6_Advanced]/techRequired$ and concentrator upgrades in $@PARTUPGRADE[kiwiSolarTier6_Concentrating]/techRequired$!</color> 
}
@PART[*]:HAS[#solarPanelUpgradeTier[7],~solarUpgrade[off]]:NEEDS[NearFutureSolar]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>The solar panel has advanced upgrades in $@PARTUPGRADE[kiwiSolarTier7_Advanced]/techRequired$ and concentrator upgrades in $@PARTUPGRADE[kiwiSolarTier7_Concentrating]/techRequired$!</color> 
}
@PART[*]:HAS[#solarPanelUpgradeTier[8],~solarUpgrade[off]]:NEEDS[NearFutureSolar]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>The solar panel has advanced upgrades in $@PARTUPGRADE[kiwiSolarTier8_Advanced]/techRequired$ and concentrator upgrades in $@PARTUPGRADE[kiwiSolarTier8_Concentrating]/techRequired$!</color> 
}