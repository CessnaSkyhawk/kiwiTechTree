// Kiwi's Tech Tree Overhaul (Science Patch)
// Version 2.0
// Created: 27 September 2020 for KSP 1.9.1 to 1.10.1
// Last Updated: 18 July 2021 for KSP 1.12.1
// 24 October 2020: Adjusted points if Kerbalism with FeatureScience is installed.
// 26 October 2020: Changed KiwiAerospace to KiwiTechTree
// 28 October 2020: Adjusted costs for B9 Procedural Wings
// 18 July 2021: Simplified the system to either have "default" values or adaptive difficulty.
// Notes: Goal is to make initial tech tree harder, but to settle into approximately 40% higher requirements over the life-time of the tree with the majority of playable parts.

@TechTree
{
	adaptiveMultiplier = 0
}

@TechTree:AFTER[Bluedog_DB]
{
	@adaptiveMultiplier += 1
}
@TechTree:AFTER[CoatlAerospace]
{
	@adaptiveMultiplier += 1
}
@TechTree:AFTER[DMagicOrbitalScience]
{
	@adaptiveMultiplier += 1
}
@TechTree:AFTER[Interkosmos]
{
	@adaptiveMultiplier += 1
}
@TechTree:AFTER[KrakenScience]
{
	@adaptiveMultiplier += 1
}
@TechTree:AFTER[LTech]
{
	@adaptiveMultiplier += 1
}
@TechTree:AFTER[MarsDirect]
{
	@adaptiveMultiplier += 1
}
@TechTree:AFTER[TantaresSP]
{
	@adaptiveMultiplier += 1
}

@TechTree:FOR[KiwiTechTree]
{
	techTreeDifficulty = #$@KIWI_GENERAL_SETTINGS/TECHTREE/DIFFICULTY$
	techTreeMultiplier = #$@KIWI_GENERAL_SETTINGS/TECHTREE/MULTIPLIER$
}

@TechTree:HAS[#techTreeDifficulty[adaptive]]:FOR[zzKiwiTechTree]
{
	@RDNode:HAS[#tier[*]]
	{
		addBase = #$../adaptiveMultiplier$
		@addBase *= #$../techTreeMultiplier$
		tierBase = #$tier$
		@tierBase ^= :\.\d+:: // Floor value to get an integer as costs can behave oddly if non-integers
		@addBase *= #$tierBase$
		@cost += #$addBase$
	}
}

@TechTree:HAS[#techTreeDifficulty[adaptive]]:AFTER[zzKiwiTechTree]
{
	@RDNode:HAS[#tier[*]]
	{
		!addBase = DELETE
		!tierBase = DELETE
	}
}