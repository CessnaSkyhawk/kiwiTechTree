


@PART[*]:HAS[~rcsUpgrade[off],@RESOURCE[MonoPropellant],!MODULE[InterstellarFuelSwitch],!MODULE[ModuleEngines*],!MODULE[FSfuelSwitch],!MODULE[WBIConvertibleStorage],!MODULE[WBIResourceSwitcher]]:NEEDS[!ModularFuelTanks&!RealFuels]:FOR[zzKiwiTechTree]
{
	//Calculate total capacity by units of default resources
	%MP = #$RESOURCE[MonoPropellant]/maxAmount$
	%totalCap = #$RESOURCE[MonoPropellant]/maxAmount$

	//Take default resource quantities and multiply by resource units costs to calculate total cost of original resources
	@MP *= #$@RESOURCE_DEFINITION[MonoPropellant]/unitCost$

	//Sum the total costs of both resources and deduct to avoid double counting once resources are added via switcher
	%costOffset = #$MP$
	@costOffset *= -1

	//remove original resources
	!RESOURCE[MonoPropellant] {}

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = kiwiRCSFuelSwitch
		switcherDescription = #LOC_KTT_B9DESCRIPTION_RCSFUELSWITCH // RCS Fuel Switch
		switcherDescriptionPlural = #LOC_KTT_B9DESCRIPTIONPLURALS_RCSFUEL // RCS Fuel Types
		baseVolume = #$../totalCap$
		SUBTYPE
		{
			name = HYDRAZINE
			title = #LOC_KTT_B9TITLE_RCS_HYDRAZINE // Hydrazine
			tankType = KiwiHydrazine
			addedMass = 0
			addedCost = 0
			defaultSubtypePriority = 1
		}
	}	
}

@PART[*]:HAS[~rcsUpgrade[off],~rcsPrimaryUpgrade[off],@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[kiwiRCSFuelSwitch]],!MODULE[InterstellarFuelSwitch],!MODULE[ModuleEngines*],!MODULE[FSfuelSwitch],!MODULE[WBIConvertibleStorage],!MODULE[WBIResourceSwitcher]]:NEEDS[!ModularFuelTanks&!RealFuels]:FOR[zzKiwiTechTree]
{
	@description = #$description$ \n\n<color=#ff0000>This part has RCS Fuel upgrades in Specialized Control (Tier 6) and Exotic Control (Tier 8)!</color>
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[kiwiRCSFuelSwitch]]
	{
		@SUBTYPE[HYDRAZINE]
		{
			upgradeRequired = rcs1Upgrade
		}
		
		SUBTYPE
		{
			name = HYDROGENPEROXIDE
			title = #LOC_KTT_B9TITLE_RCS_HYDROGENPEROXIDE // Hydrogen Peroxide
			tankType = KiwiHydrogenPeroxide
			addedMass = 0
			addedCost = 0
			defaultSubtypePriority = 0
		}
		
		SUBTYPE
		{
			name = HYPERGOLIC
			title = #LOC_KTT_B9TITLE_RCS_HYPERGOLIC // Aerozine/Nitroxide
			tankType = KiwiHypergolic
			addedMass = 0
			addedCost = 0
			defaultSubtypePriority = 0
			upgradeRequired = rcs2Upgrade
		}
	}	
}